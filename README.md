# Reversing the Contour Next Link 2.4
Tear Down of the Contour Next Link 2.4 Blood Glucose Meter.

[![Gitter chat](https://badges.gitter.im/medtronic-flash/Lobby.png)](https://gitter.im/medtronic-flash/Lobby)

The purpose of this repo is to document the steps taken in (attempting) to reverse engineer the over the air communications used on Medtronic 630g/640g pumps by examining the hardware and software on a Contour Next Link 2.4 glucose meter.

TOC
===
  * [Current Project Status](#current-project-status)
  * [What We Currently Know](#what-we-currently-know)
  * [Hardware Overview](#hardware-overview)
    * [Front](#front)
    * [Back](#back)
  * [Reversing](#reversing)
    * [Attempting to Dump the Firmware](#attempting-to-dump-the-firmware)

Current Project Status
======================
Steps currently taken in the reversing project:
 * Dissasemble CNL24 and identify chipsets onboard
 * Attempted to Dump the Firmware of the Ti cc2430 ZigBee radio
   * Próba  odczytania  Firmware DBGLOCK flag enabled, unable to read firmware

To repozytorium pomoże przejść do kolejnych kroków Next Steps:
  * Attempt to read flash memory from MX25L1606-8006E_DS_EN
    * Pending hardware delivery

What We Currently Know
======================
The OTA protocol layer is 802.15.4 spec, and pretty sure its ZigBee. A good portion of the protocol is already discovered by Pazaan on his repo at https://github.com/pazaan/decoding-contour-next-link. The current issue at hand, is that the CNL24's USB layer appears to block writing actions, and only supports reading. So with a CNL24 alone, we can read Medtronic CGM and pump settings over USB, but if we want to loop with the pumps, we have to get direct over the air access.

We need to figure out how the AES key is generated by the firmware to figure out how to connect our own custom radios to the pump.

Hardware Overview, czyli co udało mi się odkryć
=================

## Front

Nothing super interesting up front. Mostly just the BG Meter bits.


Głównym układem scalonym jest mikrokontroler PD70F3769 firmy Renesas. Package: 100-pin plastic LQFP package. 
 Omawiany mikrokontroler posiada :
 * 512 KB flash memory
 * 40 KB RAM
 * 64 MB Logical space 
 * 13 MB External memory area
 * Max. frequency: 20 MHz
 
 https://www.renesas.com/us/en/doc/products/mpumcu/doc/v850/r01uh0001ej0400_v850esjx3l.pdf
 
 


**Nieznane układy**

On the Top side , znajdują się jeszcze dwa nieznane układy scalone
 * 1?
 * 2?
Ich funkcja jest jeszcze nieznana.
! ZDJĘCIE

**układ pomiarowy glukometru**

To prawdopodobnie układ wykożystywany do wykonania pomiaru glukozy z próbki na pasku pomiarowym. Możemy go pominąć gdyż nie bierze on udziału podczas łączenia się CNL z pompa.

TOSHIBA
T5DBO0
1624 HUL
181961



![Front](https://github.com/applehat/contour-next-link-24-teardown/raw/master/front.jpg)

![Board Top/Front](https://github.com/applehat/contour-next-link-24-teardown/raw/master/board_top.jpg)



## Back side

**Ti SoC CC2430 ZigBee Radio**

Na tej stronie znajduje się uład radiowy CC2430-F128. 

Jest to układ RF firmy texas instrument, RF transceiver with an industry-standard enhanced 8051 MCU, 128 KB flash memory, 8 KB RAM. 
Z doświadczenia wiem, że 8051 nieobsługuje wszytkich standardowych funkcji, dlatego dobrze się wczytać dokumentację i erate.
Chip jest ustawiany i programowany przy każdym uruchomieniu. Nie przechowuje w sobie kodu programu. Dlatego musimy się skupić na pamieci MX25L i mikrokontrolerze PD70F3769.



http://www.ti.com/lit/ds/symlink/cc2430.pdf

CC2430-F128
5CW01HG
1549


**Flash Memory**
 
 Mikrokontroler PD70F3769  współpracuje z pamięcią flash MX25L1606-8006E_DS_EN
 This is 16M-BIT CMOS SERIAL FLASH
http://www.zlgmcu.com/mxic/pdf/NOR_Flash_c/MX25L1606-8006E_DS_EN.pdf

!ZDJĘCIE


**Układ NCP372**
Positive and Negative overvoltage protection controller.  


!zdjęcie




![Back](https://github.com/applehat/contour-next-link-24-teardown/raw/master/back.jpg)

![Back Naked](https://github.com/applehat/contour-next-link-24-teardown/raw/master/back-without-lipo-or-shielding.jpg)

![Board Bottom/Back](https://github.com/applehat/contour-next-link-24-teardown/raw/master/board_bottom.jpg)

![Debug Pins](https://github.com/applehat/contour-next-link-24-teardown/raw/master/debug-pins.jpg)

Reverse engineering
=========
Mając dostęp do specjalistycznego sprzetu, odlutowałem układy PD70F3769 oraz CC2430. Wykonałem analizę połaczeń układów na płycie głównej. Udało mi się stwożyć schemat ideowy CNL.
Na płycię głównej są umiejscowione test points. Większość udało mi się oznaczyć. Możemy wyróżnić piny szynę pamięci flash, połączenia między procesorem a radiem . Najważniejszym jest port debug.
Za jego pomocą możemy połączyć się z jednostką sterującą PD70F3769. 

!zdjęcie

Zamieszczam schemat oraz pliki bibloteki TinyCAD.

**co dalej do zrobienia**

Mam nadzieję że ta dokumentacja posłuży dalej do odtwożenia 







## Attempting to Dump the Firmware

